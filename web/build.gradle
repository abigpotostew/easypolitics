


buildscript {
    ext.kotlin_version = "${kotlin_version}"
    repositories {
        mavenCentral()
    }
}
plugins {
    id "org.kravemir.gradle.sass" version "1.2.2"
}
version 'unspecified'


apply plugin: 'java'
apply plugin: "kotlin"

String MAIN_CLASS = 'bz.stewart.bracken.web.MainKt'
String projName = "easypoliticsweb" //${project.name}
String buildRootDir = "$buildDir"
String buildResources = "${buildRootDir}/resources"

sass {
    main {
        srcDir = file("$projectDir/src/main/sass")
        outDir = file("$buildResources/main/static")
        //registerInSourceSets ( 'main' )
    }
}

repositories {
    mavenCentral()
    jcenter()
}

dependencies {
    compile "org.jetbrains.kotlin:kotlin-stdlib-jre8:$kotlin_version"
    compile 'com.sparkjava:spark-core:2.3'
    compile group: "org.jetbrains.kotlinx", name: "kotlinx-html-jvm", version: "0.6.4"
    testCompile group: 'junit', name: 'junit', version: '4.+'
}

compileKotlin {
    kotlinOptions.jvmTarget = "1.8"
}
compileTestKotlin {
    kotlinOptions.jvmTarget = "1.8"
}

mainSass{
    doFirst{
        println("Compiling Sass...")
    }
    doLast{
        println("Finished compiling Sass!")
    }
}

tasks.build.doLast {
    tasks.mainSass.execute()
}

task fatJar(type: Jar, dependsOn:build) {
    baseName = project.name + '-fat'
    from { configurations.runtime.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar
    manifest {
        attributes 'Main-Class': MAIN_CLASS
    }
}

task run(type:JavaExec,dependsOn:fatJar){
    main = MAIN_CLASS
    classpath = sourceSets.main.runtimeClasspath
}